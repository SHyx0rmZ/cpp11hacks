#ifndef _TARGET_TRAITS_HPP_
#define _TARGET_TRAITS_HPP_

#include <type_traits>

namespace cpp11hacks
{
    enum target_system_name
    {
        target_system_windows,
        target_system_linux,
        target_system_mac,
        target_system_iphone,
        target_system_unknown
    };

    const target_system_name target_system =
#if defined(_WIN32) || defined(_WIN64) || defined(__CYGWIN32__)
    target_system_windows
#elif defined(__linux__)
    target_system_linux
#elif defined(TARGET_OS_MAC)
    target_system_mac
#elif defined(TARGET_OS_IPHONE) || defined(TARGET_IPHONE_SIMULATOR)
    target_system_iphone
#else
    target_system_unknown
#endif
    ;

    template <target_system_name N = target_system>
    struct target_system_is_unknown : std::true_type
    {
    };

    template <>
    struct target_system_is_unknown<target_system_windows> : std::false_type
    {
    };

    template <target_system_name N = target_system>
    struct target_system_is_windows : std::conditional<target_system_windows == N, std::true_type, std::false_type>::type
    {
    };

    template <>
    struct target_system_is_unknown<target_system_linux> : std::false_type
    {
    };

    template <target_system_name N = target_system>
    struct target_system_is_linux : std::conditional<target_system_linux == N, std::true_type, std::false_type>::type
    {
    };

    template <>
    struct target_system_is_unknown<target_system_mac> : std::false_type
    {
    };

    template <target_system_name N = target_system>
    struct target_system_is_mac : std::conditional<target_system_mac == N, std::true_type, std::false_type>::type
    {
    };

    template <>
    struct target_system_is_unknown<target_system_iphone> : std::false_type
    {
    };

    template <target_system_name N = target_system>
    struct target_system_is_iphone : std::conditional<target_system_iphone == N, std::true_type, std::false_type>::type
    {
    };

    enum target_compiler_name
    {
        target_compiler_gcc,
        target_compiler_msc,
        target_compiler_unknown
    };

    const target_compiler_name target_compiler =
#if defined(__GNUC__)
    target_compiler_gcc
#elif defined(_MSC_VER)
    target_compiler_msc
#else
    target_compiler_unknown
#endif
    ;

    template <target_compiler_name N = target_compiler>
    struct target_compiler_is_gcc : std::conditional<target_compiler_gcc == N, std::true_type, std::false_type>::type
    {
    };

    template <target_compiler_name N = target_compiler>
    struct target_compiler_is_msc : std::conditional<target_compiler_msc == N, std::true_type, std::false_type>::type
    {
    };

    template <target_compiler_name N = target_compiler>
    struct target_compiler_is_unknown : std::conditional<target_compiler_unknown == N, std::true_type, std::false_type>::type
    {
    };
}

#if (defined(_M_X64) || defined(__amd64__)) && !defined(RK_CPU_X64)
#define RK_CPU_X64
#elif (defined(_M_IX86) || defined(__i386__)) && !defined(RK_CPU_X86)
#define RK_CPU_X86
#else
#error Unrecognized CPU
#endif

#if !defined(RK_EXPORT)
#if defined(RK_COMPILER_MSC)
#define RK_EXPORT __declspec(dllexport)
#elif defined(RK_COMPILER_GCC) && defined(RK_SYSTEM_WINDOWS)
#define RK_EXPORT __attribute__((dllexport))
#elif defined(RK_COMPILER_GCC)
#define RK_EXPORT
#endif
#endif

#if !defined(RK_IMPORT)
#if defined(RK_COMPILER_MSC)
#define RK_IMPORT __declspec(dllimport)
#elif defined(RK_COMPILER_GCC) && defined(RK_SYSTEM_WINDOWS)
#define RK_IMPORT __attribute__((dllimport))
#elif defined(RK_COMPILER_GCC)
#define RK_IMPORT
#endif
#endif

#if !defined(RK_LIBRARY)
#if defined(_WINDLL) || defined(DLL_EXPORT)
#define RK_LIBRARY RK_EXPORT
#else
#define RK_LIBRARY RK_IMPORT
#endif
#endif

#if defined(_DEBUG)
#define RK_DEBUG
#endif

#endif
